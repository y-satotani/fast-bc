\chapter{更新アルゴリズム}
\label{chap:algorithm-on-insert}

\section{一辺挿入時の更新アルゴリズム}
\label{sect:update-dist-on-insert}

\begin{algorithm}[H]
  \caption{一辺挿入時の一頂点への最短経路長を更新するアルゴリズム}
  \label{algo:update-dist-on-insert}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺挿入前の最短経路長$d_{xz},\,(x\in V)$
    \Ensure 辺挿入後の最短経路長$d'_{xz},\,(x\in V)$
    \Procedure{InsertUpdateDist}{$G,(v,w),z$}
    \State $d'_{xz}\gets d_{xz}$
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\mathrm{DistAffected}\gets\varnothing$
    \State $\mathrm{DepAffected}\gets\varnothing$
    \State $\mathrm{WorkSet}\gets\{(v,w)\}$
    \State $\mathrm{VisitedVertices}\gets\{v\}$
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から有向辺$(x,u)$を取り出す
    \If{$l_{xu}+d'_{uz}<d'_{xz}$}
    \State $d'_{xz}=l_{xu}+d'_{uz}$
    \State $\mathrm{DistAffected}\gets\mathrm{DistAffected}\cup\{x\}$
    \ForAll{$y\in\mathcal{N}_G(x)$ s.t. $y\notin\mathrm{DistAffected}\land SP(y,x,v)$}
    \State $\mathrm{WorkSet}\gets\mathrm{WorkSet}\cup\{(y,x)\}$
    \State $\mathrm{VisitedVertices}\gets\mathrm{VisitedVertices}\cup\{y\}$
    \EndFor
    \ForAll{$y\in\mathcal{N}_G(x)$ s.t. $(d_{xz}=l_{xy}+d_{yz})\land(d_{xz}\neq\infty)$}
    \State $\mathrm{DepAffected}\gets\mathrm{DepAffected}\cup\{y\}$
    \EndFor
    \EndIf
    \EndWhile
    \State \textbf{return} $\mathrm{DistAffected},\mathrm{DepAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺挿入時の一頂点への最短経路数を更新するアルゴリズム}
  \label{algo:update-sigma-on-insert}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺挿入前の最短経路数$\sigma_{xz},\,(x\in V)$
    \Ensure 辺挿入後の最短経路数$\sigma'_{xz},\,(x\in V)$
    \Procedure{InsertUpdateSigma}{$G,(v,w),z,\mathrm{DistAffected}$}
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\sigma'_{xz}\gets\sigma_{xz}$
    \State $\mathrm{PathAffected}\gets\mathrm{DistAffected}$
    \State $\mathrm{DepAffected}\gets\varnothing$
    \State $\mathrm{WorkSet}\gets\{(d'_{vw}, (v, w))\}$
    \State $\mathrm{VisitedVertices}\gets\{v\}$
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から有向辺$(x,u)$を取り出す
    \State $\sigma_{\mathrm{old}}\gets\sigma'_{xz}$
    \State $\sigma\gets\sum_{y\in \mathcal(N)_G(x)\mathrm{s.t.}SP(x,y,z)}\sigma'_{yz}$
    \State $\sigma_{xz}\gets\sigma$
    \If{$x\in\mathrm{PathAffected}\lor x\neq z\land\sigma_{\mathrm{old}}\neq\sigma$}
    \State $\sigma'_{xz}\gets\sigma$
    \State $\mathrm{PathAffected}\gets\mathrm{PathAffected}\cup\{x\}$
    \State $\mathrm{DepAffected}\gets\mathrm{DepAffected}\cup\{x\}$
    \ForAll{$y\in\mathcal{N}_G(x)$ s.t. $SP(y,x,v)\land y\notin\mathrm{VisitedVertices}$}
    \State 距離が昇順になるように$\mathrm{WorkSet}$に$(d'_{yz},(y,x))$を追加
    \State $\mathrm{VisitedVertices}\gets\mathrm{VisitedVertices}\cup\{y\}$
    \EndFor
    \EndIf
    \EndWhile
    \State \textbf{return} $\mathrm{PathAffected}$, $\mathrm{DepAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺挿入時の一頂点に対するペア依存度を更新するアルゴリズム}
  \label{algo:update-pd-on-insert}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺挿入前のペア依存度$\delta_z(x),\,(x\in V)$
    \Ensure 辺挿入後のペア依存度$\delta'_z(x),\,(x\in V)$
    \Procedure{InsertUpdatePD}{$G,(v,w),z,\mathrm{DepAffected}$}
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\delta'_z(x)\gets\delta_z(x)$
    \State $\mathrm{VisitedVertices}\gets\mathrm{DepAffected}$
    \State $\mathrm{WorkSet}\gets((d'_{xz},x)|x\in\mathrm{AffectedDependencies},x\mathrm{は}d'_{xz}\mathrm{の昇順に並べられている})$
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から頂点$x$を取り出す
    \If{$x\neq z$}
    \State $\delta'_z(x)\gets\sum_{y\in\mathcal{N}_G(x)\mathrm{s.t.}SP(y,x,z)}\frac{\sigma'_{xz}}{\sigma'_{yz}}(1+\delta'_z(y)$
    \ForAll{$y\in\mathcal{N}_G(x)\mathrm{s.t.}SP(x,y,z)$}
    \State 距離が昇順になるように$\mathrm{WorkSet}$に$(d'_{yz},y)$を追加
    \State $\mathrm{VisitedVertices}\gets\mathrm{VisitedVertices}\cup\{y\}$
    \EndFor
    \EndIf
    \EndWhile
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺挿入時の媒介中心性更新アルゴリズム}
  \label{algo:update-bc-on-insert}
  \begin{algorithmic}[1]
    \Require グラフ$G=(V,E)$，挿入辺$\{v,w\}$とその長さ$c$
    \Ensure 辺挿入後の媒介中心性$B'(x),\,(x\in V)$
    \Procedure{InsertUpdate}{$G,(v,w),z$}
    \State $\mathrm{DistAffected},\mathrm{DepAffectedD}\gets\textproc{InsertUpdateDist}(G,(w,v),z)$
    \State $\mathrm{PathAffected},\mathrm{DepAffectedS}\gets\textproc{InsertUpdateSigma}(G,(w,v),z,\mathrm{DistAffected})$
    \State $\mathrm{DepAffected}\gets\mathrm{DepAffectedD}\cup\mathrm{DepAffectedS}$
    \State $\textproc{InsertUpdatePD}(G,(w,v),z,\mathrm{DepAffected})$
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
    \State グラフ$G$に$l_{vw}=c$として辺$\{v,w\}$を追加
    \State $\mathrm{AffectedSinks}\gets\textproc{InsertUpdate}(G,(w,v),v,d,\sigma,\delta)$
    \State $\mathrm{AffectedSources}\gets\textproc{InsertUpdate}(G,(v,w),w,d,\sigma,\delta)$
    \ForAll{$z\in\mathrm{AffectedSinks}$}
    \State $\textproc{InsertUpdate}(G,(v,w),z,d,\sigma,\delta)$
    \EndFor
    \ForAll{$z\in\mathrm{AffectedSources}$}
    \State $\textproc{InsertUpdate}(G,(w,v),z,d,\sigma,\delta)$
    \EndFor
  \end{algorithmic}
\end{algorithm}

\section{一辺削除時の更新アルゴリズム}
\label{sect:algorithm-on-delete}

\begin{algorithm}[H]
  \caption{一辺削除時の一頂点への最短経路長を更新するアルゴリズム}
  \label{algo:update-dist-on-delete}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺削除前の最短経路長$d_{xz},\,(x\in V)$
    \Ensure 辺削除後の最短経路長$d'_{xz},\,(x\in V)$
    \Procedure{DeleteUpdateDist}{$G,(v,w),z$}
    \State $d'_{xz}\gets d_{xz}$
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\mathrm{DistAffected}\gets\varnothing$
    \If{$\exists x\in\mathcal{N}_G(v), SP(v,x,z)$}
    \State $\mathrm{WorkSet}\gets\varnothing$
    \Else
    \State $\mathrm{WorkSet}\gets\{v\}$
    \EndIf
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から頂点$u$を取り出す
    \State $\mathrm{DistAffected}\gets\mathrm{DistAffected}\cup\{u\}$
    \ForAll{$x\in\mathcal{N}_G(u)$ s.t. $SP(x,u,z)$}
    \If{$\forall y\in\mathcal{N}_G(x), \neg SP(x,y,z)\lor y\in\mathrm{DistAffected}$}
    \State $\mathrm{WorkSet}\gets\mathrm{WorkSet}\cup\{x\}$
    \EndIf
    \EndFor
    \EndWhile
    \State $\mathrm{PriorityQueue}\gets\varnothing$
    \ForAll{$a\in\mathrm{DistAffected}$}
    \State $d'_{az}=\min(\{l_{ab}+d'_{bz}|b\in\mathcal{N}_G(a),b\notin\mathrm{DistAffected}\}\cup\{\infty\})$
    \If{$d'_{az}\neq\infty$}
    \State $d'_{az}$をキーとして$a$を$\mathrm{PriorityQueue}$に追加
    \EndIf
    \EndFor
    \While{$\mathrm{PriorityQueue}\neq\varnothing$}
    \State $\mathrm{PriorityQueue}$から最小キーの頂点$a$を取り出す
    \ForAll{$c\in\mathcal{N}_G(a)$ s.t. $l_{ca}+d'_{az}<d_{cz}$}
    \State $d'_{cz}=l_{ca}+d'_{az}$
    \State $\mathrm{PriorityQueue}$の$c$のキーを$d'_{cz}$に更新
    \EndFor
    \EndWhile
    \State \textbf{return} $\mathrm{DistAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺削除時の一頂点への最短経路数を更新するアルゴリズム}
  \label{algo:update-sigma-on-delete}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺削除前の最短経路数$\sigma_{xz},\,(x\in V)$，
    最短経路長が変化した頂点の集合$\mathrm{DistAffected}$
    \Ensure 辺削除後の最短経路数$\sigma'_{xz},\,(x\in V)$
    \Procedure{DeleteUpdateSigma}{$G,(v,w),z,\mathrm{DistAffected}$}
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\sigma'_{xz}\gets\sigma_{xz}$
    \State $\mathrm{PathAffected}\gets\mathrm{DistAffected}$
    \If{$d_{vz}=d_{wz}$}
    \State $\mathrm{WorkSet}\gets\varnothing$
    \Else
    \State $\mathrm{WorkSet}\gets\{v\}$
    \EndIf
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から頂点$u$を取り出す
    \State $\mathrm{PathAffected}\gets\mathrm{PathAffected}\cup\{u\}$
    \ForAll{$x\in\mathcal{N}_G(u)$ s.t. $SP(x,u,z)$}
    \If{$\exists y\in\mathcal{N}_G(x), \neg SP(x,y,z)\lor y\in\mathrm{PathAffected}$}
    \State $\mathrm{WorkSet}$に$d'_{xz}$をキーとして$x$を追加
    \EndIf
    \EndFor
    \EndWhile
    \ForAll{$a\in\mathrm{WorkSet}$\ (ただし，順番はキー($d_{az}$)の昇順)}
    \State $\sigma'_{az}\gets\sum_{b\in\mathcal{N}_G(a)\mathrm{s.t.}SP(a,b,z)}\sigma'_{bz}$
    \EndFor
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺削除時の一頂点に対するペア依存度を更新するアルゴリズム}
  \label{algo:update-pd-on-delete}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺削除前のペア依存度$\delta_z(x),\,(x\in V)$，
    最短経路長または最短経路数が変化した頂点の集合$\mathrm{PathAffected}$
    \Ensure 辺削除後のペア依存度$\delta'_z(x),\,(x\in V)$
    \Procedure{DeleteUpdatePD}{$G,(v,w),z,\mathrm{PathAffected}$}
    \State $\delta'_z(x)\gets\delta_z(x)$
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\mathrm{PriorityQueue}\gets\{(d'_{xz},x)|x\in\mathrm{PathAffected}\}$
    \If{$d_{vz}\neq d_{wz}$}
    \State $d'_{wz}$をキーとして$\mathrm{PirorityQueue}$に$w$を追加
    \EndIf
    \State $\mathrm{VisitedVertices}\gets\{x|x\in\mathrm{PriorityQueue}\}$
    \While{$\mathrm{PriorityQueue}\neq\varnothing$}
    \State $\mathrm{PriorityQueue}$から最大キー($d'_{xz}$)の頂点$x$を取り出す
    \If{$x\neq z$}
    \State $\delta_z(x)=\sum_{y\in\mathcal{N}_G(x)\mathrm{s.t.}SP(y,x,z)}\frac{\sigma'_{xz}}{\sigma'_{yz}}(1+\delta_z(y))$
    \ForAll{$y\in\mathcal{N}_G(x)\mathrm{s.t.}SP(x,y,z)\land y\notin\mathrm{VisitedVertices}$}
    \State $\mathrm{PriorityQueue}$に$d'_{yz}$をキーとして$y$を追加
    \State $\mathrm{VisitedVertices}\gets\mathrm{VisitedVertices}\cup\{y\}$
    \EndFor
    \EndIf
    \EndWhile
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺削除時の媒介中心性更新アルゴリズム}
  \label{algo:update-bc-on-delete}
  \begin{algorithmic}[1]
    \Require グラフ$G=(V,E)$，削除辺$\{v,w\}$
    \Ensure 辺削除後の媒介中心性$B'(x),\,(x\in V)$
    \Procedure{DeleteUpdate}{$G,(v,w),z$}
    \State $\mathrm{DistAffected}\gets\textproc{DeleteUpdateDist}(G,(w,v),z)$
    \State $\mathrm{PathAffected}\gets\textproc{DeleteUpdateSigma}(G,(w,v),z,\mathrm{DistAffected})$
    \State $\textproc{DeleteUpdatePD}(G,(w,v),z,\mathrm{PathAffected})$
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
    \State グラフ$G$から辺$\{v,w\}$を削除
    \State $\mathrm{AffectedSinks}\gets\textproc{DeleteUpdate}(G,(w,v),v)$
    \State $\mathrm{AffectedSources}\gets\textproc{DeleteUpdate}(G,(v,w),w)$
    \ForAll{$z\in\mathrm{AffectedSinks}$}
    \State $\textproc{DeleteUpdate}(G,(v,w),z)$
    \EndFor
    \ForAll{$z\in\mathrm{AffectedSources}$}
    \State $\textproc{DeleteUpdate}(G,(w,v),z)$
    \EndFor
    \State $B'(z)\gets\sum_{x\in V}\delta'_z(x),\,\forall z\in V$
  \end{algorithmic}
\end{algorithm}
