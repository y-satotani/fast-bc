\chapter{一辺削除時の媒介中心性の変化量}
\label{chap:update-bc-on-delete}
本章では，$G=(V,E)$に辺$e=\{\alpha,\beta\} \not\in E$を削除して得られるグラフを
$G'=(V,E')$とする．$G'$における頂点$s$から頂点$t\,(\neq s)$への最短経路を有向グラフ
$G'_{st}=(V'_{st},E'_{st})$で表し，頂点$s$から他のすべての頂点への最短経
路を有向グラフ$G'_s=(V,E'_s)$で表す．また，$G'$における頂点$s$から
頂点$t\,(\neq s)$への最短経路の個数と長さをそれぞれ$\sigma'_{st}$, 
$d'_{st}$で表す．

\section{一辺削除時の最短経路長の変化量}
\label{sect:update-dist-on-delete}

\begin{algorithm}[H]
  \caption{一辺削除時の一頂点への最短経路長を更新するアルゴリズム}
  \label{algo:update-dist-on-delete}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺削除前の最短経路長$d_{xz},\,(x\in V)$
    \Ensure 辺削除後の最短経路長$d'_{xz},\,(x\in V)$
    \Procedure{DeleteUpdateDist}{$G,(v,w),z$}
    \State $d'_{xz}\gets d_{xz}$
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\mathrm{DistAffected}\gets\varnothing$
    \If{$\exists x\in\mathcal{N}_G(v), SP(v,x,z)$}
    \State $\mathrm{WorkSet}\gets\varnothing$
    \Else
    \State $\mathrm{WorkSet}\gets\{v\}$
    \EndIf
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から頂点$u$を取り出す
    \State $\mathrm{DistAffected}\gets\mathrm{DistAffected}\cup\{u\}$
    \ForAll{$x\in\mathcal{N}_G(u)$ s.t. $SP(x,u,z)$}
    \If{$\forall y\in\mathcal{N}_G(x), \neg SP(x,y,z)\lor y\in\mathrm{DistAffected}$}
    \State $\mathrm{WorkSet}\gets\mathrm{WorkSet}\cup\{x\}$
    \EndIf
    \EndFor
    \EndWhile
    \State $\mathrm{PriorityQueue}\gets\varnothing$
    \ForAll{$a\in\mathrm{DistAffected}$}
    \State $d'_{az}=\min(\{l_{ab}+d'_{bz}|b\in\mathcal{N}_G(a),b\notin\mathrm{DistAffected}\}\cup\{\infty\})$
    \If{$d'_{az}\neq\infty$}
    \State $d'_{az}$をキーとして$a$を$\mathrm{PriorityQueue}$に追加
    \EndIf
    \EndFor
    \While{$\mathrm{PriorityQueue}\neq\varnothing$}
    \State $\mathrm{PriorityQueue}$から最小キーの頂点$a$を取り出す
    \ForAll{$c\in\mathcal{N}_G(a)$ s.t. $l_{ca}+d'_{az}<d_{cz}$}
    \State $d'_{cz}=l_{ca}+d'_{az}$
    \State $\mathrm{PriorityQueue}$の$c$のキーを$d'_{cz}$に更新
    \EndFor
    \EndWhile
    \State \textbf{return} $\mathrm{DistAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\section{一辺削除時の最短経路数の変化量}
\label{sect:update-sigma-on-delete}

\begin{algorithm}[H]
  \caption{一辺削除時の一頂点への最短経路数を更新するアルゴリズム}
  \label{algo:update-sigma-on-delete}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺削除前の最短経路数$\sigma_{xz},\,(x\in V)$，
    最短経路長が変化した頂点の集合$\mathrm{DistAffected}$
    \Ensure 辺削除後の最短経路数$\sigma'_{xz},\,(x\in V)$
    \Procedure{DeleteUpdateSigma}{$G,(v,w),z,\mathrm{DistAffected}$}
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\sigma'_{xz}\gets\sigma_{xz}$
    \State $\mathrm{PathAffected}\gets\mathrm{DistAffected}$
    \If{$d_{vz}=d_{wz}$}
    \State $\mathrm{WorkSet}\gets\varnothing$
    \Else
    \State $\mathrm{WorkSet}\gets\{v\}$
    \EndIf
    \While{$\mathrm{WorkSet}\neq\varnothing$}
    \State $\mathrm{WorkSet}$から頂点$u$を取り出す
    \State $\mathrm{PathAffected}\gets\mathrm{PathAffected}\cup\{u\}$
    \ForAll{$x\in\mathcal{N}_G(u)$ s.t. $SP(x,u,z)$}
    \If{$\exists y\in\mathcal{N}_G(x), \neg SP(x,y,z)\lor y\in\mathrm{PathAffected}$}
    \State $\mathrm{WorkSet}$に$d'_{xz}$をキーとして$x$を追加
    \EndIf
    \EndFor
    \EndWhile
    \ForAll{$a\in\mathrm{WorkSet}$\ (ただし，順番はキー($d_{az}$)の昇順)}
    \State $\sigma'_{az}\gets\sum_{b\in\mathcal{N}_G(a)\mathrm{s.t.}SP(a,b,z)}\sigma'_{bz}$
    \EndFor
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\section{一辺削除時のペア依存度の変化量}
\label{sect:update-pd-on-delete}

\begin{algorithm}[H]
  \caption{一辺削除時の一頂点に対するペア依存度を更新するアルゴリズム}
  \label{algo:update-pd-on-delete}
  \begin{algorithmic}[1]
    \Require 更新対象の頂点$z$，辺削除前のペア依存度$\delta_z(x),\,(x\in V)$，
    最短経路長または最短経路数が変化した頂点の集合$\mathrm{PathAffected}$
    \Ensure 辺削除後のペア依存度$\delta'_z(x),\,(x\in V)$
    \Procedure{DeleteUpdatePD}{$G,(v,w),z,\mathrm{PathAffected}$}
    \State $\delta'_z(x)\gets\delta_z(x)$
    \State $SP(a,b,c)\triangleq(d'_{ac}=l_{ab}+d'_{bc})\land(d'_{ac}\neq\infty)$
    \State $\mathrm{PriorityQueue}\gets\{(d'_{xz},x)|x\in\mathrm{PathAffected}\}$
    \If{$d_{vz}\neq d_{wz}$}
    \State $d'_{wz}$をキーとして$\mathrm{PirorityQueue}$に$w$を追加
    \EndIf
    \State $\mathrm{VisitedVertices}\gets\{x|x\in\mathrm{PriorityQueue}\}$
    \While{$\mathrm{PriorityQueue}\neq\varnothing$}
    \State $\mathrm{PriorityQueue}$から最大キー($d'_{xz}$)の頂点$x$を取り出す
    \If{$x\neq z$}
    \State $\delta_z(x)=\sum_{y\in\mathcal{N}_G(x)\mathrm{s.t.}SP(y,x,z)}\frac{\sigma'_{xz}}{\sigma'_{yz}}(1+\delta_z(y))$
    \ForAll{$y\in\mathcal{N}_G(x)\mathrm{s.t.}SP(x,y,z)\land y\notin\mathrm{VisitedVertices}$}
    \State $\mathrm{PriorityQueue}$に$d'_{yz}$をキーとして$y$を追加
    \State $\mathrm{VisitedVertices}\gets\mathrm{VisitedVertices}\cup\{y\}$
    \EndFor
    \EndIf
    \EndWhile
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[H]
  \caption{一辺削除時の媒介中心性更新アルゴリズム}
  \label{algo:update-bc-on-delete}
  \begin{algorithmic}[1]
    \Require グラフ$G=(V,E)$，削除辺$\{v,w\}$
    \Ensure 辺削除後の媒介中心性$B'(x),\,(x\in V)$
    \Procedure{DeleteUpdate}{$G,(v,w),z$}
    \State $\mathrm{DistAffected}\gets\textproc{DeleteUpdateDist}(G,(w,v),z)$
    \State $\mathrm{PathAffected}\gets\textproc{DeleteUpdateSigma}(G,(w,v),z,\mathrm{DistAffected})$
    \State $\textproc{DeleteUpdatePD}(G,(w,v),z,\mathrm{PathAffected})$
    \State \textbf{return} $\mathrm{PathAffected}$
    \EndProcedure
    \State グラフ$G$から辺$\{v,w\}$を削除
    \State $\mathrm{AffectedSinks}\gets\textproc{DeleteUpdate}(G,(w,v),v)$
    \State $\mathrm{AffectedSources}\gets\textproc{DeleteUpdate}(G,(v,w),w)$
    \ForAll{$z\in\mathrm{AffectedSinks}$}
    \State $\textproc{DeleteUpdate}(G,(v,w),z)$
    \EndFor
    \ForAll{$z\in\mathrm{AffectedSources}$}
    \State $\textproc{DeleteUpdate}(G,(w,v),z)$
    \EndFor
    \State $B'(z)\gets\sum_{x\in V}\delta'_z(x),\,\forall z\in V$
  \end{algorithmic}
\end{algorithm}
