\chapter{準備}

\section{グラフの数学的記法}

グラフ$G=(V,E)$，$V$は頂点集合，$E$は辺集合$\subset V\times V$

辺集合が非順序対の集合であるとき，グラフは無向と呼ばれる．
逆に，辺集合が順序対の集合であるとき，グラフは有向と呼ばれる．

また，無向グラフの各辺$\{v,w\}\in E$および有向グラフの各辺$(v,w)\in E$には正の重み$l_{vw}>0$を与えている．

隣接する，接続している
$G$の頂点$v$の近傍$\mathcal{N}_G(v)$

頂点とそれに接続している辺が交互に並び，両端が頂点である列を有向道と呼ぶ．
記号と用いると，
\[ (v_1,e_1,v_2,\ldots,v_{n-1},e_n,v_n)\ (v_i\in V,\ e_i\in E) \]
である．
有向道は有向グラフとみなすことができ，例えば，有向道
\[ (v_1,e_1,v_2,\ldots,v_{n-1},e_{n-1},v_n) \]
を有向グラフとして表すと$G=(V,E)=(\{v_1,\ldots,v_n\},\{e_1,\ldots,e_{n-1}\})$である．

$G$の異なる2頂点$s,t$を両端とする有向道の中で，有向道に含まれる辺の重みの総和が最小であるものを，$s$から$t$への最短経路と呼ぶ．
頂点$s$から頂点$t$への最短経路の辺の重みの総和を最短経路長$d_{st}$，最短経路の数を最短経路数$\sigma_{st}$と呼ぶ．
以下の議論では，便宜上，すべての$s\in V$に対し$d_{ss}=0$, $\sigma_{ss}=1$とする．
また，$s$から$t$への最短経路の中で頂点$v$を通るものの個数を$\sigma_{st}(v)$で表す．
頂点$s$から他の頂点へのすべての最短経路で構成される有向グラフを$G_s=(V_s,E_s)$で表す．
同様に，頂点$s$から頂点$t$へのすべての最短経路で構成される有向グラフを$G_{st}=(V_{st},E_{st})$で表す．

\section{最短経路長および最短経路数の性質}

最短経路の長さと個数について，いくつかの補題を示す．

\begin{lemma}[Brandes~\cite{Brandes2001}]
  $G=(V,E)$の異なる2頂点$s,t \in V$に対して，$s$から$t$への最短経路$G_{st}=(V_{st},E_{st})$が$i \in V$を含む，すなわち$i \in V_{st}$であるための必要十分条件は
  \begin{equation}
    d_{st}=d_{si}+d_{it}
    \label{eqn:inclusion0}
  \end{equation}
  が成り立つことである．
  \label{lemma:1}
\end{lemma}
\begin{proof}
  はじめに$i=s$の場合を考える．このとき明らかに$i \in V_{st}$であり，かつ$d_{si}+d_{it}=d_{ss}+d_{st}=d_{st}$より\eqref{eqn:inclusion0}もつねに成り立つ．$i=t$の場合も同様である．そこで以下では$i \not\in \{s,t\}$と仮定する．$G_{st}$が頂点$i$を含むならば，$G_{st}$の中に$s \rightarrow \cdots \rightarrow i \rightarrow \cdots \rightarrow t$の順に頂点を通る有向道が存在する．この有向道の長さは$d_{si}+d_{it}$で与えられるので\eqref{eqn:inclusion0}が成り立つ．次に\eqref{eqn:inclusion0}が成り立つと仮定する．頂点$s$を出発して$s$から$i$への最短経路の一つを通って$i$に行き，次に$i$から$t$への最短経路の一つを通って$t$に行く有向道を考える．この有向道は$s$から$t$への最短経路の一つである．なぜなら，その長さは$d_{si}+d_{it}$で与えられ，\eqref{eqn:inclusion0}より$s$から$t$への最短経路長$d_{st}$に等しいからである．したがって$i \in V_{st}$が成り立つ．
\end{proof}

\begin{lemma}
  $G=(V,E)$の異なる2頂点$s,t\in V$と辺$\{i,j\} \in E$を考える．$s$から$t$への最短経路$G_{st}=(V_{st},E_{st})$が有向辺$(i,j)$を含む，すなわち$(i,j) \in E_{st}$が成り立つための必要十分条件は
  \begin{equation}
    d_{st}=d_{si}+l_{ij}+d_{jt}
    \label{eqn:inclusion}
  \end{equation}
  が成り立つことである．
  \label{lemma:2}
\end{lemma}
\begin{proof}
  はじめに$i=s$, $j=t$の場合を考える．このとき明らかに$G_{st}$は
  有向辺$(i,j)$を含み，かつ$d_{si}+l_{ij}+d_{jt}=d_{ss}+l_{st}+d_{tt}=l_{st}=d_{st}$
  より\eqref{eqn:inclusion}も成り立つ．次に$i=s$, $j \neq t$の場合を
  考える．このとき$(i,j)\in E_{st}$であるための必要十分条件は$G_{st}$が
  $j$を含むことである．これは補題~\ref{lemma:1}より
  $d_{st}=d_{sj}+d_{jt}$と等価であり，さらに右辺$d_{sj}+d_{jt}$は
  \eqref{eqn:inclusion}の右辺と等しい．$i\neq s$, $j=t$の場合も同様である．
  そこで以下では$s,t,i,j$がすべて異なると仮定する．
  $G_{st}$が有向辺$(i,j)$を含むならば，$G_{st}$の中に
  $s \rightarrow \cdots \rightarrow i \rightarrow j \rightarrow \cdots \rightarrow t$
  の順に頂点を通る有向道が存在する．
  この有向道の長さは$d_{si}+l_{ij}+d_{jt}$で与えられるので\eqref{eqn:inclusion}が
  成り立つ．次に\eqref{eqn:inclusion}が成り立つと仮定する．頂点
  $s$を出発して$s$から$i$への最短経路の一つを通って$i$に行き，次に
  辺$\{i,j\}$を通って$j$に行き，最後に$j$から$t$への最短経路の一つを
  通って$t$に行く有向道が存在する．この有向道は$s$から$t$への最短経路の一つで
  ある．なぜなら，その長さは$d_{si}+l_{ij}+d_{jt}$で与えられ，
  \eqref{eqn:inclusion}より$s$から$t$への最短経路長$d_{st}$に
  等しいからである．したがって，$(i,j) \in E_{st}$が成り立つ．
\end{proof}

\begin{lemma}[Brandes\cite{Brandes2001}]
  $G=(V,E)$の異なる2頂点$s,t \in V$に対して，
  $s$から$t$への最短経路の中で$i$を通るものの個数$\sigma_{st}(i)$は
  次式で与えられる．
  \begin{equation}
    \sigma_{st}(i)=
    \left\{
    \begin{array}{ll}
      \sigma_{si} \sigma_{it}, & d_{st}=d_{si}+d_{it}\,\mbox{のとき} \\
      0, & \mbox{それ以外のとき}
    \end{array}
    \right.
    \label{eqn:sigma_sti}
  \end{equation}
  \label{lemma:3}
\end{lemma}

\begin{lemma}
  $G=(V,E)$の異なる2頂点$s,t \in V$に対して，
  $s$から$t$への最短経路の中で有向辺$(i,j)$を通るものの個数を
  $\sigma_{st}(i,j)$とおくと，それは次式で与えられる．
  \begin{equation*}
    \sigma_{st}(i,j)=
    \left\{
    \begin{array}{ll}
      \sigma_{si} \sigma_{jt}, & d_{st}=d_{si}+l_{ij}+d_{jt}\,\mbox{のとき} \\
      0, & \mbox{それ以外のとき}
    \end{array}
    \right.
    %\label{eqn:sigma_stij}
  \end{equation*}
  \label{lemma:4}
\end{lemma}

次の補題は，ある二頂点間の最短経路の長さと，その経路に含まれる短い最短経路の長さに関するものである．
\begin{lemma}
  \label{lemma:distance-of-path}
  $G=(V,E)$の異なる二頂点$s,t\in V$について，次が成り立つ．
  \begin{equation*}
    d_{st}=\min\{d_{si}+d_{it}|i\in V\}
  \end{equation*}
\end{lemma}
\begin{proof}
  TBA
\end{proof}

次の補題は，重みなしグラフのある二頂点間の最短経路の個数と，その経路に含まれる短い最短経路の個数との関係を示す．
\begin{lemma}
  \label{lemma:number-of-paths}
  重みなしグラフ$G=(V,E)$の異なる二頂点$s,t\in V$について，$v$を$d_{st}=d_{sv}+d_{vt}$
  である頂点(ただし$v\neq s,t$)とすると，次が成り立つ．
  \begin{equation}
    \label{eq:number-of-paths}
    \sigma_{st}=\frac{\sum_{v}\sigma_{sv}\sigma_{vt}}{d_{st}-1}
  \end{equation}
\end{lemma}
\begin{proof}
  $s$と$t$の間の一般的な経路を図\ref{fig:proof-number-of-paths}に示す．
  \begin{figure}
    \centering
    \def\svgwidth{.5\columnwidth}
    \input{proof-number-of-paths.pdf_tex}
    \caption{$s$と$t$の一般的な最短経路}
    \label{fig:proof-number-of-paths}
  \end{figure}
  $s$からの距離が一定の頂点を並べて，一つの層とする．$d_{sv}=k$なる頂点$v$の集合を，第$k$層と定義し，$L_k$と表す．$L_k$に属する頂点の数を$n_k$，$L_k$に属する$l$番目の頂点を$v_{kl}$と表す．ここで，第$k$層に属する頂点$v$は，隣接する層(第$k-1$層と第$k+1$層)以外の層に属する頂点$w$と隣接しないことに注意する．もしそのような頂点が存在すると，最短経路長が変化する．式\eqref{eq:number-of-paths}の両辺に$d_{st}-1$を掛けて，次の式\eqref{eq:number-of-paths1}を得る．
  \begin{equation}
    \sigma_{st}(d_{st}-1)=\sum_{v}\sigma_{sv}\sigma_{vt}
    \label{eq:number-of-paths1}
  \end{equation}
  式\eqref{eq:number-of-paths1}の右辺を，
  図\ref{fig:proof-number-of-paths}にならって表すと，
  \begin{equation}
    \sum_{v}\sigma_{sv}\sigma_{vt}=
    \sum_{k=1}^m\sum_{l=1}^{n_k}\sigma_{sv_{kl}}\sigma_{v_{kl}t}
    \label{eq:number-of-paths2}
  \end{equation}
  が得られる．ここで，二つの頂点$v$と$w$について，次の隣接を表す記号$a$を導入する．
  \begin{align*}
    a_{vw}=
    \begin{cases}
      1 & vとwが隣接しているとき \\
      0 & vとwが隣接していないとき
    \end{cases}
  \end{align*}
  各々の$\sigma_{sv_{kl}}\sigma_{v_{kl}t}$について議論する．$a$の定義を用いて式を変形すると，
  \begin{align}
    &\sigma_{sv_{kl}}\sigma_{v_{kl}t}\nonumber\\
    =&\left(\sum_{v'\in L_{k-1}}\sigma_{sv'}a_{v'v_{kl}}\right)
    \left(\sum_{v'\in L_{k+1}}\sigma_{v_{kl}v'}a_{v't}\right)
    \nonumber\\
    =&\left(\sum_{v''\in L_{k-2}}\sum_{v'\in L_{k-1}}
    \sigma_{sv''}a_{v''v'}a_{v'v_{kl}}\right)
    \left(\sum_{v'\in L_{k+1}}\sum_{v''\in L_{k+2}}
    a_{v_{kl}v'}a_{v'v''}\sigma_{v''t}\right)
    \nonumber\\
    &\vdots\nonumber\\
    =&\left(\sum_{(v_1,\ldots,v_{k-1})\in L_1\times\cdots\times L_{k-1}}
    a_{sv_1}\cdots a_{v_{k-1}v_{kl}}\right)
    \left(\sum_{(v_{k+1},\ldots,v_m)\in L_{k+1}\times\cdots\times L_m}
    a_{v_{kl}v_{k+1}}\cdots a_{v_mv_t}\right)\nonumber\\
    =&\sum_{(v_1,\ldots,v_{k-1},v_{k+1},\ldots,v_m)\in L_1\times\cdots\times L_{k-1}\times L_{k+1}\times\cdots\times L_m}
    a_{sv_1}\cdots a_{v_{k-1}v_{kl}}a_{v_{kl}v_{k+1}}\cdots a_{v_mt}
    \label{eq:number-of-paths3}
  \end{align}
  が得られる．式\eqref{eq:number-of-paths3}を式\eqref{eq:number-of-paths2}に
  代入すると，
  \begin{align}
    &\sum_{k=1}^m\sum_{l=1}^{n_k}\sigma_{sv_{kl}}\sigma_{v_{kl}t}\nonumber\\
    =&\sum_{k=1}^m\sum_{l=1}^{n_k}\sum_{
      (v_1,\ldots,v_{k-1},v_{k+1},\ldots,v_m)\in
      L_1\times\cdots\times L_{k-1}\times L_{k+1}\times\cdots\times L_m
    }a_{sv_1}\cdots a_{v_{k-1}v_{kl}}a_{v_{kl}v_{k+1}}\cdots a_{v_mt}\nonumber\\
    =&\sum_{k=1}^m\sum_{(v_1,\ldots,v_m)\in L_1\times\cdots\times L_m}
    a_{sv_1}\cdots a_{v_mt}\nonumber\\
    =&m\left(\sum_{(v_1,\ldots,v_m)\in L_1\times\cdots\times L_m}
    a_{sv_1}\cdots a_{v_mt}\right)
    \label{eq:number-of-paths4}
  \end{align}
  と変形できる．式\eqref{eq:number-of-paths4}の総和の対象が$1$となるのは，
  $a_{sv_1},\ldots,a_{v_mt}$のすべてが$1$のとき，
  すなわち，$s$と$v_1$,$v_1$と$v_2$,$\ldots$,$v_m$と$t$がすべて隣接している
  とき，すなわち，$s$と$t$の最短経路となっているときである．
  従って，総和の値は$s$と$t$の最短経路の数と一致し，
  式\eqref{eq:number-of-paths4}は$\sigma_{st}(d_{st}-1)$と等しい．
  従って，補題が成り立つ．
\end{proof}

\section{媒介中心性とペア依存度}
頂点$i$の媒介中心性$B_i$は
\begin{equation}
  B_i=\sum_{s\neq i}\sum_{t\neq {i,s}}\frac{\sigma_{st}(i)}{\sigma_{st}}
  \label{eq:betweenness-centrality}
\end{equation}
で定義される\cite{Freeman1977}．
すなわち，頂点$i$の媒介中心性は$s$から$t$への最短経路の個数とその中で頂点$i$を通るものの個数の比を$s,t$のすべての組について足し合わせたものである．したがって，媒介中心性の大きな頂点は多くの2頂点を結ぶ最短経路上にあり，この意味で重要度が高いと言える．

すべての頂点の媒介中心性を求める単純な方法は以下の通りである．まず，$s=1,2,\ldots,N$に対して，幅優先探索を用いて$s$から他のすべての頂点への最短経路を求める．その過程で，$s$から他のすべての頂点への最短経路長と最短経路数も同時に求める．次に，互いに異なる3頂点の組$\{s,t,i\}$のすべてに対して，$\sigma_{st}(i)$の値を計算する（どうやって??）．
最後に媒介中心性$B_i$ $(i=1,2,\ldots,N)$を(\ref{eq:betweenness-centrality})により計算する．しかしながら，この方法の計算量は$\mathcal{O}(N^3)$であり，大規模なネットワークでは膨大な計算時間が必要になる．

媒介中心性の効率的計算法として最も広く用いられているのはBrandes~\cite{Brandes2001}によって提案されたアルゴリズムである．それを以下に示す．

Brandesのアルゴリズムは次のペア依存度を用いて効率的に媒介中心性を計算する．
\begin{equation*}
  \begin{aligned}
    B_v&=\sum_{s\neq v}\sum_{t\neq v,s}\frac{\sigma_{st}(v)}{\sigma_{st}}
    &=\sum_{s\neq v}\sum_{t\neq v,s}\delta_{st}(v)
  \end{aligned}
\end{equation*}
で定義される．$\delta_{st}(v)=\frac{\sigma_{st}(v)}{\sigma_{st}}$は頂点$s,t,v$のペア依存度と呼ばれる．頂点$s,v$と他の頂点のペア依存度$\delta_{s}(v)=\sum_{t\neq v,s}\delta_{st}(v)$について，次のことが知られている．
\begin{equation*}
  \delta_{s}(v)=\sum_{(v,w)\in E_s}\frac{\sigma_{sv}}{\sigma_{sw}}(1+\delta_{s}(w)).
\end{equation*}
Brandesのアルゴリズムはこの性質を応用して媒介中心性を高速に計算している．

このアルゴリズムの計算量を考える．ステップ2は$\mathcal{O}(M)$の時間で実行できる．
ステップ4についても，$G$のすべての頂点を$s$からの最短経路の逆向きに一度だけ辿ることにより$\{\delta_s(i)\}_{i=1}^N$の値を更新できるため，$\mathcal{O}(M)$の時間で実行できる~\cite{Brandes2001}．
したがって，アルゴリズム~\ref{algo:brandes}の全体の計算量は$\mathcal{O}(NM)$であり，それは$\mathcal{O}(N^3)$よりも小さい．特にグラフが疎であるとき，すなわち$M \ll N^2$が成り立つとき前者は後者に比べて非常に小さな値となる．


\section{最短経路とペア依存度の変化に関する条件}

\textcolor{red}{3章に移動する可能性あり}

ここでは，一辺が挿入または削除されたあとの最短経路およびペア依存度が変化する条件について述べる．

記号について，挿入または削除の操作後であることを明示するため，記号$'$をつける．例えば，操作後のグラフは$G'$と表す．

\begin{lemma}
  \label{lemma:condition-of-invariability-of-shortest-path}
  $E_{yx}=E'_{yx}$であることの必要十分条件は，$d_{yx}=d'_{yx}$かつ$\sigma_{yx}=\sigma'_{yx}$である．
\end{lemma}
\begin{proof}
  $E_{yx}=E'_{yx}$なら$d_{yx}=d'_{yx}$かつ$\sigma_{yx}=\sigma'_{yx}$であることは自明である．

  逆は，図\ref{fig:proof-invariability-of-paths}のような$E_{yx}$を，$d_{yx}=d'_{yx}$かつ$\sigma_{yx}=\sigma'_{yx}$を満たすように，$E_{yx}\neq E'_{yx}$とするには，少なくとも一辺の削除と一辺の挿入が必要である．
  挿入時，レイヤーの距離より長い辺を挿入すると$E_{yx}=E'_{yx}$である．また，レイヤーの距離が等しくなるように結ぶと，$\sigma_{yx}\neq\sigma'_{yx}$となる．また，レイヤーの距離より短い辺を挿入すると$d_{yx}\neq d'_{yx}$になる．また，削除時，$e\notin E_{yx}$である辺を削除すると，$E_{yx}=E'_{yx}$である．また，$e\in E_{yx}$である辺を削除すると，$d_{yx}\neq d'_{yx}$または$\sigma_{yx}\neq\sigma'_{yx}$となる．
  したがってそのような操作は不可能で，逆も成り立つ．

  \begin{figure}
    \centering
    \def\svgwidth{.5\columnwidth}
    \input{proof-invariability-of-paths.pdf_tex}
    \caption{$s$と$t$の一般的な最短経路}
    \label{fig:proof-invariability-of-paths}
  \end{figure}
\end{proof}

\begin{lemma-without-proof}
  \label{lemma:condition-of-invariability-of-pairwise-dependency}
  ペア依存度
  \begin{equation}
    \label{eq:pairwise-dependency}
    \delta_s(v)=\sum_{(v,w)\in E_s}\frac{\sigma_{sv}}{\sigma_{sw}}(1+\delta_s(w))
  \end{equation}
  について，操作によって$\sigma_{sv}$および集合$W=\{w|(v,w)\in E_s\}$が変化せず，各$w\in W$の$\sigma_{sw}$および$\delta_s(w)$が操作によって変化しないならば，操作後のペア依存度
 \begin{equation}
    \label{eq:pairwise-dependency-after-update}
    \delta'_s(v)=\sum_{(v,w)\in E'_s}\frac{\sigma'_{sv}}{\sigma'_{sw}}(1+\delta'_s(w))
  \end{equation}
 も変化しない．
\end{lemma-without-proof}

補題\ref{lemma:condition-of-invariability-of-pairwise-dependency}の逆は成り立たない．例えば，図\ref{fig:pd-invariability-counterexample}において$\delta_s(v_1)=\delta'_s(v_1)$であるが，$\delta_s(w_1)\neq\delta'_s(w_1)$である．同様に，$\delta_s(v_2)=\delta'_s(v_2)$であるが，$\sigma_{sv_2}\neq\sigma'_{sv_2}$である．

\begin{figure}[tb]
  \centering
  \def\svgwidth{.45\linewidth}
  \input{pd-invariability-counterexample.pdf_tex}
  \caption{補題\ref{lemma:condition-of-invariability-of-pairwise-dependency}の逆の反例}
  \label{fig:pd-invariability-counterexample}
\end{figure}

\begin{lemma}
  \label{lemma:transformation-of-invariability-of-pairwise-dependency}
  頂点$s,v$の操作前のペア依存度
  \begin{equation}
    \label{eq:pairwise-dependency}
    \delta_s(v)=\sum_{(v,w)\in E_s}\frac{\sigma_{sv}}{\sigma_{sw}}(1+\delta_s(w))
  \end{equation}
  と操作後のペア依存度
  \begin{equation}
    \label{eq:pairwise-dependency-after-update}
    \delta'_s(v)=\sum_{(v,w)\in E'_s}\frac{\sigma'_{sv}}{\sigma'_{sw}}(1+\delta'_s(w))
  \end{equation}
  に関して，これらは同値である．
  \begin{enumerate}
  \item $\sigma_{sv}=\sigma'_{sv}$かつ，集合$W=\{(v,w)\in E_s\}$と集合$W'=\{(v,w)\in E'_s\}$が等しく，すべての$(v,w)\in W$に対して$\sigma_{sv}$と$\sigma_{sw}$,$\delta_s(w)$が操作によって変化しない
    \label{item:explicit-invariability-of-pairwise-dependency}
  \item $\sigma_{sv}=\sigma'_{sv}$かつ，集合$X=\{(x,y)|(x,y)\in E_s,d_{sy}=d_{sv}+d_{vx}+l_{xy}\}$と集合$X'=\{(x,y)|(x,y)\in E'_s,d'_{sy}=d'_{sv}+d'_{vx}+l_{xy}\}$が等しく，すべての$(x,y)\in X$に対して$\sigma_{sy}$が操作によって変化しない
    \label{item:implicit-invariability-of-pairwise-dependency}
  \end{enumerate}
\end{lemma}
\begin{proof}
  \ref{item:explicit-invariability-of-pairwise-dependency}が成り立つならば，
  集合$W_2=\{(w,w_2)|(w,w_2)\in E_s,(v,w)\in W\}$が操作によって変化せず，
  すべての$(w,w_2)\in W_2$に対して$\sigma_{sw_2}$と$\delta_s(w_2)$が操作によって変化しない．

  すべての$w_2\in W_2$に対して$\delta_s(w_2)$が変化しないので，同様に，
  集合$W_3=\{(w_2,w_3)|(w_2,w_3)\in E_s,(w,w_2)\in W_2\}$が操作によって変化せず，
  すべての$(w_2,w_3)\in W_3$に対して$\sigma_{sw_3}$と$\delta_s(w_3)$が操作によって変化しない．

  同じことを繰り返すと，集合$W^*=W\cup W_2\cup W_3\cup\cdots\cup W_k$が操作によって変化せず，すべての$(\hat{w},w)\in W^*$に対して$\sigma_{sw}$は操作によって変化しないことが言える．（$G_s$が有向アサイクリックグラフなので，上記の操作によって作られる$W^*$は有限集合である．また，$(\hat{w},w)\in\{(\hat{w},w)|(\hat{w},w)\in W^*,\{w'|(w,w')\in E_s\}=\varnothing\}$に対して，$\delta_s(w)=0$なので，この条件は消去できる）

  
  また，各$W_i$は$W_i=\{(w_{i-1},w_i)|(w_{i-1},w_i)\in\mathcal{N}^{i-1}_G(v)\times\mathcal{N}^i_G(v),(w_{i-1},w_i)\in E_s,d_{sw_i}=d_{sv}+d_{vw_{i-1}}+l_{w_{i-1}w_i}\}$と書き換えられるので，$G$は連結グラフであることから，$W^*=\cup_{i=0}W_i=\{(\hat{w},w)|(\hat{w},w)\in\cup_{i=0}\mathcal{N}^{i-1}_G(v)\times\mathcal{N}^i_G(v),(\hat{w},w)\in E_s,d_{sw}=d_{sv}+d_{v\hat{w}}+l_{\hat{w}w}\}=\{(\hat{w},w)|(\hat{w},w)\in E_s,d_{sw}=d_{sv}+d_{v\hat{w}}+l_{\hat{w}w}\}$とできる．

  よって，\ref{item:explicit-invariability-of-pairwise-dependency}$\Rightarrow$\ref{item:implicit-invariability-of-pairwise-dependency}が成り立つ．

  \ref{item:implicit-invariability-of-pairwise-dependency}$\Rightarrow$\ref{item:explicit-invariability-of-pairwise-dependency}も，先の手順を逆向きに適用することにより導出できる．
\end{proof}

まとめると，補題\ref{lemma:transformation-of-invariability-of-pairwise-dependency}における$X$が変化するような$s,v$の組を見つけることによって，空振りが含まれるが，ペア依存度$\delta_s(v)$を更新する．
