\chapter{準備}
\label{chap:preliminary}
本章では，後の章に向けての準備をする．はじめに，最短経路や距離を含む，
グラフ理論の基本事項を説明する．
次に，距離や最短経路の数に関する重要な性質を示す．
最後に，媒介中心性とその計算に用いられるペア依存度について説明する．

\section{グラフの数学的表現}
\label{sect:graph-theory}

\textbf{グラフ}とは，二つの集合$V$と$E$の組$G=(V,E)$で，
$E\subset V^2$を満たす．つまり，$V$から元を2個取り出した集合の部分集合である．
$V$を\textbf{頂点集合}とよび，その元を\textbf{頂点}とよぶ．
また，頂点集合の要素数$|V|$を\textbf{頂点数}とよぶ．
$E$を\textbf{辺集合}とよび，その元を\textbf{辺}とよぶ．
また，辺集合の要素数$|E|$を\textbf{頂点数}とよぶ．
$E$の要素が順序対ならば，$G$は\textbf{有向グラフ}と呼ばれ，
非順序対ならば$G$は\textbf{無向グラフ}と呼ばれる．
有向グラフの辺$e=(v,w)$において，頂点$v$を始点，頂点$w$を終点と呼ぶ．
グラフ$G=(V,E)$と$G'=(V',E')$に対して，$V'\subset V$かつ$E'\subset E$
を満たすとき，$G'$は$G$の\textbf{部分グラフ}であるといい，$G'\in G$と記す．
有向グラフ$G$について，各辺$(v,w)$を逆向きにしたグラフを$G$の逆と呼び，$\bar{G}$で表す．
すなわち，$G=(V,E)$のとき，$\bar{G}=(V,\{(w,v)|(v,w)\in E\})$である．

\textbf{重み付きグラフ}とは，すべての辺$(v,w)$もしくは$\{v,w\}$に対して，
辺の重み$l_{vw}\in\mathbb{R}$が定められているグラフである．
以下，特に断らない限り辺の重みは正であるとする．
また，重み付きグラフでないグラフを\textbf{重みなしグラフ}と呼ぶ．

無向グラフにおいて，頂点$v$と辺$e$が\textbf{接続する}とは，$v\in e$つまり，
$e$の端点に$v$が属することをいう．
頂点$v$と頂点$w$が\textbf{隣接する}とは，$\{v,w\}$が辺集合$E$に属することをいう．
無向グラフ$G$の頂点$v$について，$v$と隣接する頂点の集合を頂点$v$の\textbf{近傍}と
呼び，$\mathcal{N}_G(v)$で表す．また，無向グラフ$G$について$v$の近傍の数
$|\mathcal{N}_G(v)|$を\textbf{次数}と呼び，$k(v)$あるいは$k_G(v)$と記す．
すべての頂点の次数が等しいグラフを\textbf{正則グラフ}と呼ぶ．
頂点$v$の近傍の各頂点の近傍の和集合$\cup_{w\in\mathcal{N}_G(v)}\mathcal{N}_G(w)$を
$\mathcal{N}_G^2(v)$と記す．$\mathcal{N}_G^1(v)=\mathcal{N}_G(v)$とし，
$\mathcal{N}_G^i=\cup_{w\in\mathcal{N}_G^{i-1}(v)}\mathcal{N}_g(w)$とする．

無向グラフ$G=(\{1,\ldots,n\},E)$に対して，次の行列$A\in\{0,1\}^{n\times n}$を
\textbf{隣接行列}と呼ぶ．
\begin{equation*}
  a_{ij}=
  \begin{cases}
    1 & (i\text{と}j\text{が隣接する}) \\
    0. & (i\text{と}j\text{が隣接しない})
  \end{cases}
\end{equation*}

有向グラフ$G$の頂点$v$について，$v$を終点とする辺の始点の集合を\textbf{先行}
(predecessor)と呼び，$\mathcal{P}_G(v)$と記す．すなわち，
$\mathcal{P}_G(v)=\{u|(u,v)\in E\}$である．
同様に，$v$を始点とする辺の終点の集合を\textbf{後継}(successor)と呼び，
$\mathcal{S}_G(v)$と記す．すなわち，$\mathcal{S}_G(v)=\{w|(v,w)\in E\}$である．
近傍と同様に，$\mathcal{P}_G^i(v)$および$\mathcal{S}_G^i(v)$を用いる．

有向な\textbf{道グラフ}，あるいは単に道とは，$P=(V,E)$のグラフで，
\begin{equation*}
  \begin{aligned}
  V&=\{v_0,v_1,\ldots,v_k\}, \\
  E&=\{(v_0,v_1),(v_1,v_2),\ldots,(v_{k-1},v_k)\}
  \end{aligned}
\end{equation*}
を満たすものである．道グラフ$P=(\{v_i\},\{e_i\})$の頂点および辺の並びを
示すために，次の表記を用いる．
\[ v_1,e_1,v_2,\ldots,v_{n-1},e_n,v_n \]
重み付き経路グラフに対して，その重みの総和を経路の長さと呼ぶ．

重み付きグラフ$G$上の頂点$s$と頂点$t$について，それらを結ぶ道$P\subset G$のうち，
長さが最小のものを\textbf{最短経路}と呼ぶ．$G$の頂点$s$と頂点$t$の最短経路のうち，
ひとつの長さを$s$と$t$の\textbf{最短距離}あるいは\textbf{距離}と呼び，$d_{st}$と表す．
重みなしグラフの距離は，重みをすべて$1$と仮定して計算することが多い．
距離と同様に，$s$と$t$を結ぶ最短経路の数を\textbf{最短経路数}と呼び，$\sigma_{st}$と記す．
$G$が無向グラフであるならば，すべての$s,t\in S$に対して$d_{st}=d_{ts}$かつ
$\sigma_{st}=\sigma_{ts}$である．
以下の議論では，便宜上，すべての$s\in V$に対し$d_{ss}=0$, $\sigma_{ss}=1$とする．

また，$s$から$t$への最短経路の中で頂点$v$を通るものの個数を$\sigma_{st}(v)$で表す．
頂点$s$から他の頂点へのすべての最短経路で構成される有向グラフを$G_s=(V_s,E_s)$で表す．
同様に，頂点$s$から頂点$t$へのすべての最短経路で構成される有向グラフを$G_{st}=(V_{st},E_{st})$で表す．
さらに，頂点$s$と頂点$v$について，$G_s$のトポロジカルソートにおいて$v$より後に位置する頂点集合と$v$で
構成される部分グラフを$G_s(v)=(V_s(v),E_s(v))$で表す．すなわち，
$V_s(v)=\{w|w\in V_s,d_{sw}=d_{sv}+d_{vw}\}, E_s(v)=\{(w,x)|(w,x)\in E_s,d_{sx}=d_{sv}+d_{vw}+l_{wx}\}$
である．

\begin{example}
  図\ref{fig:graph-diamond}にグラフの例を示す．記号を囲んだ円は頂点を表し，
  それらを繋ぐ線分は辺を表す．頂点を識別するため，円の中に記号を入れる場合がある．
  線分の傍らにある数字は辺の重みを表す．頂点集合は
  \[ \{A,B,C,D,E,F,G,H\} \]
  で，辺集合は
  \[ \{\{A,B\},\{A,E\},\{B,C\},\{B,D\},\{C,E\},\{D,E\},\{E,F\},\{E,G\},\{F,H\},\{G,H\}\} \]
  である．また，$B$と$H$のひとつの最短経路は
  \[ B,(B,C),C,(C,E),E,(E,F),F,(F,H),H \]
  である．さらに，$d_{BH}=7,\,\sigma_{BH}=4$である．
  \begin{figure}
    \centering
    \def\svgwidth{.45\textwidth}
    \input{graph-diamond.pdf_tex}
    \caption{グラフの例}
    \label{fig:graph-diamond}
  \end{figure}
\end{example}

\section{最短経路長および最短経路数の性質}
\label{sect:shortest-paths}

最短経路の長さと個数について，いくつかの補題を示す．
まず，ある頂点が最短経路に含まれる条件を示す．

\begin{lemma}[Brandes~\cite{Brandes2001}]
  \label{lemma:inclusion-v}
  $G=(V,E)$の異なる2頂点$s,t \in V$に対して，$s$から$t$への最短経路
  $G_{st}=(V_{st},E_{st})$が$i \in V$を含む，すなわち$i \in V_{st}$であるための
  必要十分条件は
  \begin{equation}
    d_{st}=d_{si}+d_{it}
    \label{eq:inclusion-v}
  \end{equation}
  が成り立つことである．
\end{lemma}
\begin{proof}
  はじめに$i=s$の場合を考える．このとき明らかに$i \in V_{st}$であり，
  かつ$d_{si}+d_{it}=d_{ss}+d_{st}=d_{st}$より\eqref{eq:inclusion-v}もつねに成り立つ．
  $i=t$の場合も同様である．そこで以下では$i \not\in \{s,t\}$と仮定する．

  $G_{st}$が頂点$i$を含むならば，$G_{st}$の中に
  $s \rightarrow \cdots \rightarrow i \rightarrow \cdots \rightarrow t$の順に
  頂点を通る有向道が存在する．この有向道の長さは$d_{si}+d_{it}$で与えられるので
  \eqref{eq:inclusion-v}が成り立つ．

  次に\eqref{eq:inclusion-v}が成り立つと仮定する．頂点$s$を出発して$s$から$i$への
  最短経路の一つを通って$i$に行き，次に$i$から$t$への最短経路の一つを通って$t$に行く有向道を考える．
  この有向道は$s$から$t$への最短経路の一つである．
  なぜなら，その長さは$d_{si}+d_{it}$で与えられ，\eqref{eq:inclusion-v}より
  $s$から$t$への最短経路長$d_{st}$に等しいからである．
  したがって$i \in V_{st}$が成り立つ．
\end{proof}

補題\ref{lemma:inclusion-v}の証明の考え方を用いれば，ある頂点を通過する最短経路数を導出できる．

\begin{lemma-without-proof}[Brandes\cite{Brandes2001}]
  $G=(V,E)$の異なる2頂点$s,t \in V$に対して，
  $s$から$t$への最短経路の中で$i$を通るものの個数$\sigma_{st}(i)$は
  次式で与えられる．
  \begin{equation}
    \sigma_{st}(i)=
    \begin{cases}
      \sigma_{si} \sigma_{it}, & d_{st}=d_{si}+d_{it}\,\text{のとき} \\
      0, & \text{それ以外のとき}
    \end{cases}
  \end{equation}
\end{lemma-without-proof}

次の補題は，ある辺が最短経路上にあることの必要十分条件を示すものである．

\begin{lemma}
  \label{lemma:inclusion-e}
  $G=(V,E)$の異なる2頂点$s,t\in V$と辺$\{i,j\} \in E$を考える．$s$から$t$への最短経路
  $G_{st}=(V_{st},E_{st})$が有向辺$(i,j)$を含む，すなわち$(i,j) \in E_{st}$が成り立つための
  必要十分条件は
  \begin{equation}
    d_{st}=d_{si}+l_{ij}+d_{jt}
    \label{eq:inclusion-e}
  \end{equation}
  が成り立つことである．
\end{lemma}
\begin{proof}
  はじめに$i=s$, $j=t$の場合を考える．このとき明らかに$G_{st}$は
  有向辺$(i,j)$を含み，かつ$d_{si}+l_{ij}+d_{jt}=d_{ss}+l_{st}+d_{tt}=l_{st}=d_{st}$
  より\eqref{eq:inclusion-e}も成り立つ．

  次に$i=s$, $j \neq t$の場合を考える．このとき$(i,j)\in E_{st}$であるための
  必要十分条件は$G_{st}$が$j$を含むことである．これは補題~\ref{lemma:inclusion-v}より
  $d_{st}=d_{sj}+d_{jt}$と等価であり，さらに右辺$d_{sj}+d_{jt}$は\eqref{eq:inclusion-e}の右辺と等しい．
  $i\neq s$, $j=t$の場合も同様である．

  そこで以下では$s,t,i,j$がすべて異なると仮定する．
  $G_{st}$が有向辺$(i,j)$を含むならば，$G_{st}$の中に
  $s \rightarrow \cdots \rightarrow i \rightarrow j \rightarrow \cdots \rightarrow t$
  の順に頂点を通る有向道が存在する．
  この有向道の長さは$d_{si}+l_{ij}+d_{jt}$で与えられるので\eqref{eq:inclusion-e}が成り立つ．

  次に\eqref{eq:inclusion-e}が成り立つと仮定する．
  頂点$s$を出発して$s$から$i$への最短経路の一つを通って$i$に行き，次に辺$\{i,j\}$を通って$j$に行き，
  最後に$j$から$t$への最短経路の一つを通って$t$に行く有向道が存在する．
  この有向道は$s$から$t$への最短経路の一つである．なぜなら，その長さは$d_{si}+l_{ij}+d_{jt}$で与えられ，
  \eqref{eq:inclusion-e}より$s$から$t$への最短経路長$d_{st}$に等しいからである．
  したがって，$(i,j) \in E_{st}$が成り立つ．
\end{proof}

補題\ref{lemma:inclusion-e}の証明の考え方を用いれば，ある辺を通る最短経路数を導出できる．

\begin{lemma-without-proof}
  $G=(V,E)$の異なる2頂点$s,t \in V$に対して，
  $s$から$t$への最短経路の中で有向辺$(i,j)$を通るものの個数を
  $\sigma_{st}(i,j)$とおくと，それは次式で与えられる．
  \begin{equation*}
    \sigma_{st}(i,j)=
    \begin{cases}
      \sigma_{si} \sigma_{jt}, & d_{st}=d_{si}+l_{ij}+d_{jt}\,\text{のとき} \\
      0, & \text{それ以外のとき}
    \end{cases}
  \end{equation*}
\end{lemma-without-proof}

次の補題は，最短距離および最短経路数を，ほかの頂点とのもので陰に表すことができる
ことを示している．

\begin{lemma}
  \label{lemma:distance-and-geodesics}
  $G=(V,E)$の異なるに頂点$s,t\in V$について，次が成り立つ．
  \begin{equation*}
    \begin{aligned}
      d_{st}&=\min\{l_{si}+d_{it}|i\in\mathcal{N}_G(s)\} \\
      \sigma_{st}&=\sum_{i\in\mathcal{N}_G(s),\,d_{st}=l_{si}+d_{it}}\sigma_{it}
    \end{aligned}
  \end{equation*}
\end{lemma}
\begin{proof}
  すべての辺の重みは正であるため，頂点$s$から頂点$v$までの最短経路の最後の辺は，
  $d_{su}<d_{su}$が成立する編集号に含まれる辺$(u,v)$である．これは，補題1
  \par $G=(V,E$の互いに異なる3頂点$s,t,v$に対して，$s$から$t$への最短経路の集合
  $G_{st}=(V_{st},E_{st})$が$v$を含む，すなわち，$v\in E_{st}$が成り立つための
  必要十分条件は$d_{st}=d_{sv}+d_{vt}$である．

  より頂点$s$から頂点$v$までの最短経路の数は，頂点$s$から頂点$u$までの
  最短経路の数と等しいと言える．
\end{proof}

次の補題は，重みなしグラフのある二頂点間の最短経路の個数と，
その経路に含まれる短い最短経路の個数との関係を示す．
\begin{lemma}
  \label{lemma:number-of-paths}
  重みなしグラフ$G=(V,E)$の異なる二頂点$s,t\in V$について，$v$を$d_{st}=d_{sv}+d_{vt}$
  である頂点(ただし$v\neq s,t$)とすると，次が成り立つ．
  \begin{equation}
    \label{eq:number-of-paths}
    \sigma_{st}=\frac{\sum_{v}\sigma_{sv}\sigma_{vt}}{d_{st}-1}
  \end{equation}
\end{lemma}
\begin{proof}
  \begin{figure}
    \centering
    \def\svgwidth{.5\columnwidth}
    \input{proof-number-of-paths.pdf_tex}
    \caption{$s$と$t$の一般的な最短経路}
    \label{fig:proof-number-of-paths}
  \end{figure}
  $s$と$t$の間の一般的な経路を図\ref{fig:proof-number-of-paths}に示す．
  $s$からの距離が一定の頂点を並べて，一つの層とする．
  $d_{sv}=k$なる頂点$v$の集合を，第$k$層と定義し，$L_k$と表す．
  $L_k$に属する頂点の数を$n_k$，$L_k$に属する$l$番目の頂点を$v_{kl}$と表す．
  ここで，第$k$層に属する頂点$v$は，隣接する層(第$k-1$層と第$k+1$層)以外の層に
  属する頂点$w$と隣接しないことに注意する．もしそのような頂点が存在すると，
  最短経路長が変化する．
  式\eqref{eq:number-of-paths}の両辺に$d_{st}-1$を掛けて，次の式\eqref{eq:number-of-paths1}を得る．

  \begin{equation}
    \sigma_{st}(d_{st}-1)=\sum_{v}\sigma_{sv}\sigma_{vt}
    \label{eq:number-of-paths1}
  \end{equation}

  式\eqref{eq:number-of-paths1}の右辺を，
  図\ref{fig:proof-number-of-paths}にならって表すと，

  \begin{equation}
    \sum_{v}\sigma_{sv}\sigma_{vt}=
    \sum_{k=1}^m\sum_{l=1}^{n_k}\sigma_{sv_{kl}}\sigma_{v_{kl}t}
    \label{eq:number-of-paths2}
  \end{equation}

  が得られる．ここで，二つの頂点$v$と$w$について，次の隣接を表す記号$a$を導入する．

  \begin{align*}
    a_{vw}=
    \begin{cases}
      1 & vとwが隣接しているとき \\
      0 & vとwが隣接していないとき
    \end{cases}
  \end{align*}

  各々の$\sigma_{sv_{kl}}\sigma_{v_{kl}t}$について議論する．$a_{vw}$の定義を用いて式を変形すると，

  \begin{align}
    &\sigma_{sv_{kl}}\sigma_{v_{kl}t}\nonumber\\
    =&\left(\sum_{v'\in L_{k-1}}\sigma_{sv'}a_{v'v_{kl}}\right)
    \left(\sum_{v'\in L_{k+1}}\sigma_{v_{kl}v'}a_{v't}\right)
    \nonumber\\
    =&\left(\sum_{v''\in L_{k-2}}\sum_{v'\in L_{k-1}}
    \sigma_{sv''}a_{v''v'}a_{v'v_{kl}}\right)
    \left(\sum_{v'\in L_{k+1}}\sum_{v''\in L_{k+2}}
    a_{v_{kl}v'}a_{v'v''}\sigma_{v''t}\right)
    \nonumber\\
    &\vdots\nonumber\\
    =&\left(\sum_{(v_1,\ldots,v_{k-1})\in L_1\times\cdots\times L_{k-1}}
    a_{sv_1}\cdots a_{v_{k-1}v_{kl}}\right)
    \left(\sum_{(v_{k+1},\ldots,v_m)\in L_{k+1}\times\cdots\times L_m}
    a_{v_{kl}v_{k+1}}\cdots a_{v_mv_t}\right)\nonumber\\
    =&\sum_{(v_1,\ldots,v_{k-1},v_{k+1},\ldots,v_m)\in L_1\times\cdots\times L_{k-1}\times L_{k+1}\times\cdots\times L_m}
    a_{sv_1}\cdots a_{v_{k-1}v_{kl}}a_{v_{kl}v_{k+1}}\cdots a_{v_mt}
    \label{eq:number-of-paths3}
  \end{align}
  が得られる．式\eqref{eq:number-of-paths3}を式\eqref{eq:number-of-paths2}に
  代入すると，
  \begin{align}
    &\sum_{k=1}^m\sum_{l=1}^{n_k}\sigma_{sv_{kl}}\sigma_{v_{kl}t}\nonumber\\
    =&\sum_{k=1}^m\sum_{l=1}^{n_k}\sum_{
      (v_1,\ldots,v_{k-1},v_{k+1},\ldots,v_m)\in
      L_1\times\cdots\times L_{k-1}\times L_{k+1}\times\cdots\times L_m
    }a_{sv_1}\cdots a_{v_{k-1}v_{kl}}a_{v_{kl}v_{k+1}}\cdots a_{v_mt}\nonumber\\
    =&\sum_{k=1}^m\sum_{(v_1,\ldots,v_m)\in L_1\times\cdots\times L_m}
    a_{sv_1}\cdots a_{v_mt}\nonumber\\
    =&m\left(\sum_{(v_1,\ldots,v_m)\in L_1\times\cdots\times L_m}
    a_{sv_1}\cdots a_{v_mt}\right)
    \label{eq:number-of-paths4}
  \end{align}

  と変形できる．式\eqref{eq:number-of-paths4}の総和の対象が$1$となるのは，
  $a_{sv_1},\ldots,a_{v_mt}$のすべてが$1$のとき，
  すなわち，$s$と$v_1$,$v_1$と$v_2$,$\ldots$,$v_m$と$t$がすべて隣接している
  とき，すなわち，$s$と$t$の最短経路となっているときである．
  従って，総和の値は$s$と$t$の最短経路の数と一致し，
  式\eqref{eq:number-of-paths4}は$\sigma_{st}(d_{st}-1)$と等しい．
  従って，補題が成り立つ．
\end{proof}

\section{媒介中心性とペア依存度}
\label{sect:pairwise-dependency}

本説では，媒介中心性の定義からその効率的な計算方法を説明する．

\begin{definition}[Freeman\cite{Freeman1977}]
  \label{def:betweenness-centrality}
  頂点$i$の媒介中心性$B_v$は
  \begin{equation}
    B_v=\sum_{s\neq v}\sum_{t\neq {v,s}}\frac{\sigma_{st}(v)}{\sigma_{st}}
    \label{eq:betweenness-centrality}
  \end{equation}
  で定義される．
\end{definition}

すなわち，頂点$v$の媒介中心性は$s$から$t$への最短経路の個数とその中で
頂点$v$を通るものの個数の比を$s,t$のすべての組について足し合わせたものである．
したがって，媒介中心性の大きな頂点は多くの最短経路上にあり，この意味で重要度が高いと言える．

すべての頂点の媒介中心性を求める単純な方法は以下の通りである．
まず，$s\in V$に対して，Dijkstra法を用いて$s$から他のすべての頂点への最短経路を求める．
その過程で，$s$から他のすべての頂点への最短距離と最短経路数も同時に求める．
次に，互いに異なる3頂点の組$\{s,t,v\}$のすべてに対して，$\sigma_{st}(v)$の値を計算する．
最後に媒介中心性$B_v$ $(v\in V)$を定義の式により計算する．
しかしながら，この方法の計算量は$\mathcal{O}(|V|^3)$であり，大規模なネットワークでは膨大な計算時間が必要になる．

媒介中心性の効率的計算法として最も広く用いられているのは
Brandes~\cite{Brandes2001}によって提案されたアルゴリズムである．
以下，Brandesのアルゴリズムについて説明する．
まず，ペア依存度の定義を示す．

\begin{definition}[Brandes\cite{Brandes2001}]
  \label{def:pairwise-dependency}
  頂点$s,t,v$のペア依存度は次式で定義される．
  \begin{equation}
    \label{eq:def-pairwise-dependency}
    \delta_{st}(v)=\frac{\sigma_{st}(v)}{\sigma_{st}}
  \end{equation}
  また，頂点$s,v$と他の頂点のペア依存度は次式で定義される．
  \begin{equation}
    \label{eq:def-sum-pairwise-dependency}
    \delta_{s}(v)=\sum_{t\neq v,s}\delta_{st}(v)
  \end{equation}
\end{definition}

ペア依存度を使って媒介中心性を表すと，
\begin{equation*}
  \begin{aligned}
    B_v&=\sum_{s\neq v}\sum_{t\neq v,s}\frac{\sigma_{st}(v)}{\sigma_{st}}
    &=\sum_{s\neq v}\sum_{t\neq v,s}\delta_{st}(v)
  \end{aligned}
\end{equation*}

である．ここで，$\delta_{s}(v)$について，次のことが知られている．

\begin{theorem-without-proof}
  \label{th:implicit-pd}
  \begin{equation}
    \label{eq:implicit-pd}
    \delta_{s}(v)=\sum_{(v,w)\in E_s}\frac{\sigma_{sv}}{\sigma_{sw}}(1+\delta_{s}(w)).
  \end{equation}
\end{theorem-without-proof}

Brandesのアルゴリズムは定理\ref{th:implicit-pd}の性質を応用して媒介中心性を高速に計算している．
Brandesのアルゴリズムをアルゴリズム\ref{algo:brandes}に示す．

このアルゴリズムの計算量を考える．まず，ある$s\in V$とすべての$v\in V$に対して
$\sigma_{sv}$を計算するときの計算量は，Dijkstra法より$\mathcal{O}(|V|\log |V|+|E|)$である．
ペア依存度の積算についても，$G$のすべての頂点$v$を$s$からの最短経路の逆向きに一度だけ辿ることにより
$\delta_s(v)$の値を更新できるため，$\mathcal{O}(|E|)$の時間で実行できる\cite{Brandes2001}．
したがって，すべての$s\in V$に対するアルゴリズムの計算量は$\mathcal{O}(|V|^2\log |V|+|V||E|)$であり，
それは$\mathcal{O}(|V|^3)$よりも小さい．

\begin{algorithm}[H]
  \caption{Brandesのアルゴリズム}
  \label{algo:brandes}
  \begin{multicols}{2}
    \begin{algorithmic}[1]\small
      \Procedure{Brandes}{$G$}
      \State $B_x\gets 0,\:\forall x\in V$
      \ForAll{$s\in V$}
      \State $S\gets()$ \Comment スタック
      \State $P_w\gets (),\:\forall w\in V$ \Comment リスト
      \State $\sigma_t\gets 0,\:\forall t\in V;\:\sigma_s\gets 1$
      \State $d_t\gets -1,\:\forall t\in V;\:d_s\gets 0$
      \State $Q\gets ()$ \Comment 順位キュー
      \State $\mathrm{push}(Q, s)$
      \While{$\lvert Q\rvert>0$}
      \State $v\gets\mathrm{pop}(Q)$
      \State $\mathrm{push}(S, v)$
      \ForAll{$w\in\mathcal{N}_G(v)$}
      \If{$d_w<0\lor d_v+l_{vw}<d_w$}
      \State $d_w\gets d_v+l_{vw}$
      \State $\sigma_w\gets\sigma_v$
      \State $P_w\gets(v)$
      \State $\mathrm{updatekey}(Q, w, d_w)$
      \EndIf
      \If{$d_w=d_v+l_{vw}$}
      \State $\sigma_w\gets\sigma_w+\sigma_v$
      \State $\mathrm{append}(P_w, v)$
      \EndIf
      \EndFor
      \EndWhile
      \State $\delta_v\gets 0,\:v\in V$
      \While{$\lvert S\rvert>0$}
      \State $w\gets\mathrm{pop}(S)$
      \ForAll{$v\in P_w$}
      \State $\delta_v\gets\delta_v+\frac{\sigma_v}{\sigma_w}(1+\delta_w)$
      \EndFor
      \If{$w\neq s$}
      \State $B_w\gets B_w+\delta_w$
      \EndIf
      \EndWhile
      \EndFor
      \EndProcedure
    \end{algorithmic}
  \end{multicols}
\end{algorithm}

